<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Clients - FitnessHub</title>

  <!-- image favicon -->
  <link rel="icon" type="image/x-icon" href="../assets/images/fitnesshub.jpg">
  <link rel="icon" type="image/jpg" sizes="32x32" href="../assets/images/fitnesshub.jpg">
  <link rel="icon" type="image/jpg" sizes="16x16" href="../assets/images/fitnesshub.jpg">
  <link rel="apple-touch-icon" href="../assets/images/fitnesshub.jpg">
  
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/clients.css">
  <script src="../vendor/gsap/gsap.min.js" defer></script>
  <script src="../vendor/gsap/ScrollTrigger.min.js" defer></script>
  <script src="../vendor/lenis/lenis.min.js" defer></script>
  <script src="../scripts/app.js" defer></script>
</head>
<body>
  <div class="pattern"></div>
  
  <div class="gradient-bg">
    <div class="gradients-container">
      <div class="g1"></div>
      <div class="g2"></div>
      <div class="g3"></div>
      <div class="interactive"></div>
    </div>
  </div>

  <header class="header-top">
    <div class="top-line">
      <div class="top-line__left">
        <a href="../index.html" class="logo">
          <img src="../assets/images/FitnessHub.svg" alt="FitnessHub">
        </a>
      </div>

      <div class="top-line__center">
        <nav class="top-mnu">
          <ul>
            <li><a href="abonnement.html" data-text="Plans">Plans</a></li>
            <li><a href="trainer.html" data-text="Dashboard">Dashboard</a></li>
            <li><a href="boutique.html" data-text="Shop">Shop</a></li>
            <li><a href="coach_account.html" data-text="Account">Account</a></li>
            <li><a href="connexion.html" data-text="Log out">Log out</a></li>
          </ul>
        </nav>
      </div>

      <div class="top-line__right">
        <div class="mnu-button">
          <button class="mnu-button__menu">
            <span></span>
            <span></span>
          </button>
        </div>
        <div class="main-menu-background"></div>
        <div class="main-menu">
          <nav class="main-menu__inner">
            <ul>
            <li><a href="abonnement.html" data-text="Plans">Plans</a></li>
            <li><a href="trainer.html" data-text="Dashboard">Dashboard</a></li>
            <li><a href="boutique.html" data-text="Shop">Shop</a></li>
            <li><a href="coach_account.html" data-text="Account">Account</a></li>
            <li><a href="connexion.html" data-text="Log out">Log out</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="page-content">
      <div class="section-head">
        <h2>My Clients</h2>
        <div class="section-head__right">
          <p class="clients-count">24 Active Clients</p>
        </div>
      </div>
      
      <div class="clients-grid">
        <!-- Client 1 -->
        <div class="client-card" onclick="viewClient(1)">
          <div class="client-image">
            <img src="../public/images/ready/client1.jpg" alt="Marcus Johnson" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Marcus Johnson</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Weight Loss</p>
            <p class="client-stats">80kg • 1m85 • 32 years</p>
            <p class="client-progress">Progress: -8kg in 3 months</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 2 -->
        <div class="client-card" onclick="viewClient(2)">
          <div class="client-image">
            <img src="../public/images/ready/client2.jpg" alt="Emma Williams" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Emma Williams</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Muscle Gain</p>
            <p class="client-stats">62kg • 1m68 • 28 years</p>
            <p class="client-progress">Progress: +5kg in 4 months</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 3 -->
        <div class="client-card" onclick="viewClient(3)">
          <div class="client-image">
            <img src="../public/images/ready/client3.jpg" alt="David Chen" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>David Chen</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Fitness Maintenance</p>
            <p class="client-stats">75kg • 1m78 • 35 years</p>
            <p class="client-progress">Progress: Maintaining well</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 4 -->
        <div class="client-card" onclick="viewClient(4)">
          <div class="client-image">
            <img src="../public/images/ready/client4.jpg" alt="Sophie Martinez" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Sophie Martinez</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Endurance Training</p>
            <p class="client-stats">58kg • 1m65 • 26 years</p>
            <p class="client-progress">Progress: Marathon ready</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 5 -->
        <div class="client-card" onclick="viewClient(5)">
          <div class="client-image">
            <img src="../public/images/ready/client5.jpg" alt="James Anderson" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>James Anderson</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Bodybuilding</p>
            <p class="client-stats">88kg • 1m80 • 30 years</p>
            <p class="client-progress">Progress: +12kg muscle</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 6 -->
        <div class="client-card" onclick="viewClient(6)">
          <div class="client-image">
            <img src="../public/images/ready/client6.jpg" alt="Isabella Garcia" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Isabella Garcia</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Weight Loss</p>
            <p class="client-stats">72kg • 1m70 • 29 years</p>
            <p class="client-progress">Progress: -6kg in 2 months</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 7 -->
        <div class="client-card" onclick="viewClient(7)">
          <div class="client-image">
            <img src="../public/images/ready/client7.jpg" alt="Oliver Brown" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Oliver Brown</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Strength Training</p>
            <p class="client-stats">92kg • 1m88 • 34 years</p>
            <p class="client-progress">Progress: +15% strength</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 8 -->
        <div class="client-card" onclick="viewClient(8)">
          <div class="client-image">
            <img src="../public/images/ready/client8.jpg" alt="Mia Rodriguez" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Mia Rodriguez</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Yoga & Flexibility</p>
            <p class="client-stats">60kg • 1m67 • 27 years</p>
            <p class="client-progress">Progress: Excellent flexibility</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 9 -->
        <div class="client-card" onclick="viewClient(9)">
          <div class="client-image">
            <img src="../public/images/ready/client9.jpg" alt="Liam Thompson" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Liam Thompson</h3>
              <span class="client-status pending">Pending</span>
            </div>
            <p class="client-goal">Goal: Weight Loss</p>
            <p class="client-stats">95kg • 1m82 • 38 years</p>
            <p class="client-progress">Progress: Just started</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 10 -->
        <div class="client-card" onclick="viewClient(10)">
          <div class="client-image">
            <img src="../public/images/ready/client10.jpg" alt="Ava Wilson" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Ava Wilson</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Postnatal Recovery</p>
            <p class="client-stats">68kg • 1m72 • 31 years</p>
            <p class="client-progress">Progress: Great recovery</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 11 -->
        <div class="client-card" onclick="viewClient(11)">
          <div class="client-image">
            <img src="../public/images/ready/client11.jpg" alt="Noah Davis" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Noah Davis</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: CrossFit Training</p>
            <p class="client-stats">78kg • 1m76 • 25 years</p>
            <p class="client-progress">Progress: Competition ready</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>

        <!-- Client 12 -->
        <div class="client-card" onclick="viewClient(12)">
          <div class="client-image">
            <img src="../public/images/ready/client12.jpg" alt="Charlotte Lee" onerror="this.style.display='none'">
          </div>
          <div class="client-info">
            <div class="client-name-row">
              <h3>Charlotte Lee</h3>
              <span class="client-status active">Active</span>
            </div>
            <p class="client-goal">Goal: Weight Loss</p>
            <p class="client-stats">85kg • 1m69 • 33 years</p>
            <p class="client-progress">Progress: -10kg in 4 months</p>
            <div class="client-button-container">
              <button class="btn-primary">Manage Client</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script src="../scripts/cookie.js" defer></script>
  <script src="../scripts/auth-manager.js" defer></script>
  <script src="../scripts/api-service.js" defer></script>
  <script>
    // ✅ CORRECTION : Fonction pour naviguer vers la page de gestion du client
    async function viewClient(clientId) {
      console.log(`🔄 Redirection vers la gestion du client #${clientId}`);
      
      // Vérifier que l'utilisateur est connecté et est un coach
      const token = CookieManager.get("token");
      const user = UserSession.getUser();
      
      if (!token || !user || !user.is_coach) {
        alert("Vous devez être connecté en tant que coach pour gérer les clients.");
        window.location.href = "../pages/connexion.html";
        return;
      }
      
      try {
        // Récupérer la liste des vrais clients du coach depuis le backend
        const response = await fetch(`http://127.0.0.1:5000/api/v1/user/coach/${user.id}/users`, {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });
        
        if (!response.ok) {
          throw new Error("Erreur lors du chargement des clients");
        }
        
        const clients = await response.json();
        
        // Vérifier que le client existe dans la liste
        if (clients && clients.length > 0) {
          // Prendre le client correspondant (index - 1 car clientId commence à 1)
          const actualClient = clients[clientId - 1];
          
          if (actualClient) {
            // Rediriger vers trainer.html avec l'ID réel du client
            window.location.href = `trainer.html?client=${actualClient.id}`;
          } else {
            alert("Client non trouvé dans votre liste.");
          }
        } else {
          alert("Vous n'avez pas encore de clients.");
        }
        
      } catch (error) {
        console.error("❌ Erreur lors de la récupération des clients:", error);
        alert("Impossible de charger les informations du client.");
      }
    }
  </script>
</body>
</html>